# プロジェクトロードマップ

このロードマップは、`sleep-smart-air-conditioner` プロジェクトの開発計画を定義します。アジャイル開発のアプローチを採用し、フェーズごとに明確な目標を設定して段階的に機能開発を進めます。

---

## フェーズ 0: 開発基盤とデータ収集・可視化基盤の構築 ✅

**目標:** プロジェクトの基盤となる開発環境を整備し、最初の価値提供として「睡眠と環境データの相関の可視化」を実現する。このフェーズで機械学習モデルの学習に不可欠なデータを蓄積開始する。

### スプリント 0: 開発環境と IaC のセットアップ ✅

- [x] **タスク:** AWS CDK (TypeScript) を用いた IaC（Infrastructure as Code）環境の構築
- [x] **タスク:** GitHub Actions を利用した CI パイプラインの初期設定（Lint, テスト）
- [x] **タスク:** セキュリティガイドライン文書化 (`docs/SECURITY_SETUP.md`)

### スプリント 1: SwitchBot Webhook 統合基盤 ✅

- [x] **タスク:** SwitchBot Webhook 統合によるリアルタイム環境データ収集システム構築
- [x] **タスク:** HMAC-SHA256 署名検証による安全な Webhook 認証実装
- [x] **タスク:** DDD 構造によるバックエンドアーキテクチャ実装
- [x] **タスク:** TDD 手法による高品質コード開発
- [x] **タスク:** GitHub Environment Secrets による認証情報管理
- [x] **タスク:** Lambda + API Gateway + DynamoDB 統合

### スプリント 2: テスト基盤と CI/CD ✅

- [x] **タスク:** 段階的テスト戦略（Mock → Local → GitHub Actions）実装
- [x] **タスク:** ES Modules 対応と型安全性確保
- [x] **タスク:** GitHub Actions 手動実行ワークフロー構築
- [x] **タスク:** 本番/開発環境分離とデプロイ自動化

## 🎊 Phase 0 完了実績

### 📈 達成された価値

- **リアルタイムデータ収集**: ポーリングから Webhook への設計変更により効率化
- **セキュリティファースト**: パブリックリポジトリでの安全な認証情報管理
- **拡張可能アーキテクチャ**: DDD + TDD による保守性の高いコードベース
- **運用準備完了**: CI/CD パイプライン + 監視基盤

---

## フェーズ 0.5: データ永続化と実デバイス統合 ✅

**目標:** 構築した基盤を使用して実際の SwitchBot デバイスからデータを収集し、DynamoDB に永続化する仕組みを完成させる。

### スプリント 3: データ永続化層実装 ✅

- [x] **タスク:** DynamoDB Repository 実装とデータアクセス層構築
- [x] **タスク:** エラーハンドリングとリトライロジック実装
- [x] **タスク:** データ整合性チェックとバリデーション強化
- [x] **タスク:** CDK 3 層アーキテクチャ（Data/Lambda/Webhook）実装

### スプリント 4: AWS 環境デプロイと基盤完成 ✅

- [x] **タスク:** AWS 環境への本格デプロイと API Gateway 設定
- [x] **タスク:** Lambda 関数と DynamoDB 権限設定の完成
- [x] **タスク:** CloudWatch Logs/メトリクスによる監視体制構築
- [x] **タスク:** 環境別認証情報管理（GitHub Actions + ローカル.env 対応）

## 🎊 Phase 0.5 完了実績

### 📈 達成された価値

- **完全な 3 層アーキテクチャ**: 責任分離による保守性向上
- **型安全なデータ処理**: TypeScript + DDD による品質確保
- **本番運用準備完了**: AWS 実環境デプロイ成功
- **データ蓄積基盤完成**: SwitchBot → DynamoDB パイプライン構築

### 🚀 デプロイ済み AWS リソース

```
✅ sleep-smart-ac-dev-data-stack      (DynamoDB テーブル)
✅ sleep-smart-ac-dev-lambda-stack    (Lambda 関数 + IAM権限)
✅ sleep-smart-ac-dev-webhook-stack   (API Gateway)

WebhookEndpoint: https://lhxc14v2c7.execute-api.ap-northeast-1.amazonaws.com/dev/webhook/switchbot
```

---

## フェーズ 1: 実デバイス統合とデータ蓄積開始 🔄

**目標:** SwitchBot 実デバイスとの統合を完了し、継続的なデータ蓄積を開始する。データ可視化により価値提供を開始。

### スプリント 5: 実デバイス統合テスト

- [ ] **タスク:** SwitchBot Hub2 実デバイスとの連携確認
- [ ] **タスク:** Webhook URL 設定とデータ受信テスト
- [ ] **タスク:** DynamoDB への実データ蓄積開始
- [ ] **タスク:** CloudWatch による監視・アラート設定

### スプリント 6: データ可視化ダッシュボード

- [ ] **タスク:** CloudWatch Dashboard による環境データ可視化
- [ ] **タスク:** 温度・湿度・照度の時系列グラフ構築
- [ ] **タスク:** データ収集状況の監視指標設定
- [ ] **タスク:** エラー通知とアラート体制構築

---

## フェーズ 2: MVP - 機械学習モデルによるエアコン自動制御

**目標:** 収集したデータを用いて睡眠の質を最大化するエアコン設定を予測する機械学習モデルを構築し、実際にエアコンを自動制御する Minimum Viable Product (MVP) を完成させる。

### スプリント 7: データ分析基盤構築

- [ ] **タスク:** DynamoDB から S3 へデータをエクスポートし、学習データセットを準備する ETL 処理を実装
- [ ] **タスク:** AWS SageMaker Studio Lab (またはローカル環境) で、収集データを用いたモデルの探索と学習を実施
  - **検討事項:** まずは「最適な設定温度」を予測する回帰モデルから着手
- [ ] **タスク:** 学習済みモデルを保存し、推論に利用できる形式でパッケージング

### スプリント 8: 推論 API とエアコン制御

- [ ] **タスク:** 学習済みモデルをデプロイし、推論リクエストを受け付ける Lambda 関数（推論 API）を作成
- [ ] **タスク:** 就寝前にフロントエンドから推論 API を呼び出し、推奨されるエアコン設定を取得する機能を実装
- [ ] **タスク:** SwitchBot API 経由でエアコンを実際に操作（ON/OFF, 温度設定）する Lambda 関数を作成・連携

---

## フェーズ 3: 機能拡張と最適化

**目標:** MVP の機能をベースに、より高度なデータ連携や省エネ、ユーザー体験の向上を目指す。

### バックログ (着手順は未定)

- [ ] **機能追加:** Health Auto Export / AutoSleep と連携し、より詳細な睡眠指標（睡眠時間、深い睡眠の割合など）を特徴量に追加
- [ ] **機能追加:** SwitchBot Plug Mini の電力消費量データを学習に加え、快適性と省エネルギーを両立するモデルへ改善
- [ ] **モデル改善:** 強化学習（A/B テストなど簡易なものから）を導入し、ユーザーからのフィードバックを元に継続的にモデルをパーソナライズ
- [ ] **UX 改善:** ユーザーごとの設定プロファイル機能
- [ ] **技術改善:** TDD/DDD プラクティスの導入検討
- [ ] **技術改善:** 処理の複雑化に応じて、一部機能をコンテナ（Fargate/ECS）へ移行することを検討
- [ ] **将来構想:** Raspberry Pi と追加センサー（CO2 濃度など）を導入したエッジコンピューティングによる精度向上

---
